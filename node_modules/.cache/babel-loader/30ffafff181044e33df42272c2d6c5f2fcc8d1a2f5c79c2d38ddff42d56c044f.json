{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useNavigate,useLocation}from'react-router-dom';import{supabase}from'../../supabaseClient';import Layout from'../../components/Layout';import{motion}from'framer-motion';import{useApp}from'../../context/AppContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PaymentStep=()=>{const{updateTransactionStatus}=useApp();const navigate=useNavigate();const location=useLocation();const{transactionId}=location.state||{};const[transaction,setTransaction]=useState(null);const[methods,setMethods]=useState([]);const[selectedMethod,setSelectedMethod]=useState(null);const[loading,setLoading]=useState(true);// --- Cargar transacción ---\nuseEffect(()=>{if(!transactionId)return;const fetchTransaction=async()=>{setLoading(true);const{data,error}=await supabase.from('transactions').select('*').eq('id',transactionId).single();if(!error)setTransaction(data);setLoading(false);};fetchTransaction();},[transactionId]);// --- Cargar métodos de pago según país origen ---\nuseEffect(()=>{if(!(transaction!==null&&transaction!==void 0&&transaction.origin_country))return;const fetchMethods=async()=>{setLoading(true);const{data,error}=await supabase.from('payment_methods_origin').select('*').eq('country_code',transaction.origin_country);if(!error)setMethods(data);else setMethods([]);setLoading(false);};fetchMethods();},[transaction]);const handleContinue=async()=>{if(!selectedMethod)return alert('Selecciona un método de pago');setLoading(true);const{error}=await supabase.from('transactions').update({payment_method_origin_id:selectedMethod.id,status:'Método seleccionado'}).eq('id',transactionId);if(!error)navigate('/send/step3',{state:{transactionId}});setLoading(false);};if(loading){return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center min-h-screen text-blue-900 font-bold\",children:\"Cargando...\"})});}if(!transaction){return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center min-h-screen text-red-500 font-bold\",children:\"No se pudo cargar la transacci\\xF3n.\"})});}if(methods.length===0){return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col items-center justify-center min-h-screen text-red-500 font-bold\",children:\"No hay m\\xE9todos de pago disponibles para tu pa\\xEDs de origen.\"})});}return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"px-6 py-8 max-w-md mx-auto\",children:[/*#__PURE__*/_jsx(motion.h2,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:\"text-2xl font-bold text-gray-800 mb-8 text-center\",children:\"Selecciona un m\\xE9todo de pago\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:methods.map(method=>/*#__PURE__*/_jsx(motion.div,{whileTap:{scale:0.98},onClick:()=>setSelectedMethod(method),className:\"p-5 rounded-2xl border shadow-md text-center font-semibold text-lg cursor-pointer transition-all duration-200 \".concat((selectedMethod===null||selectedMethod===void 0?void 0:selectedMethod.id)===method.id?'border-blue-900 bg-blue-50 text-blue-900':'border-gray-200 bg-white hover:shadow-lg'),children:method.method},method.id))}),/*#__PURE__*/_jsx(\"button\",{className:\"w-full mt-8 bg-blue-900 text-white py-3 rounded-xl text-lg font-semibold shadow-md hover:bg-blue-800 transition-colors\",onClick:handleContinue,children:\"Continuar\"})]})});};export default PaymentStep;","map":{"version":3,"names":["React","useEffect","useState","useNavigate","useLocation","supabase","Layout","motion","useApp","jsx","_jsx","jsxs","_jsxs","PaymentStep","updateTransactionStatus","navigate","location","transactionId","state","transaction","setTransaction","methods","setMethods","selectedMethod","setSelectedMethod","loading","setLoading","fetchTransaction","data","error","from","select","eq","single","origin_country","fetchMethods","handleContinue","alert","update","payment_method_origin_id","id","status","children","className","length","h2","initial","opacity","y","animate","map","method","div","whileTap","scale","onClick","concat"],"sources":["C:/Users/Usuario/Desktop/intento de app/src/pages/flows/PaymentStep.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { supabase } from '../../supabaseClient';\r\nimport Layout from '../../components/Layout';\r\nimport { motion } from 'framer-motion';\r\nimport { useApp } from '../../context/AppContext';\r\n\r\nconst PaymentStep = () => {\r\n  const { updateTransactionStatus } = useApp();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { transactionId } = location.state || {};\r\n\r\n  const [transaction, setTransaction] = useState(null);\r\n  const [methods, setMethods] = useState([]);\r\n  const [selectedMethod, setSelectedMethod] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // --- Cargar transacción ---\r\n  useEffect(() => {\r\n    if (!transactionId) return;\r\n\r\n    const fetchTransaction = async () => {\r\n      setLoading(true);\r\n      const { data, error } = await supabase\r\n        .from('transactions')\r\n        .select('*')\r\n        .eq('id', transactionId)\r\n        .single();\r\n\r\n      if (!error) setTransaction(data);\r\n      setLoading(false);\r\n    };\r\n\r\n    fetchTransaction();\r\n  }, [transactionId]);\r\n\r\n  // --- Cargar métodos de pago según país origen ---\r\n  useEffect(() => {\r\n    if (!transaction?.origin_country) return;\r\n\r\n    const fetchMethods = async () => {\r\n      setLoading(true);\r\n      const { data, error } = await supabase\r\n        .from('payment_methods_origin')\r\n        .select('*')\r\n        .eq('country_code', transaction.origin_country);\r\n\r\n      if (!error) setMethods(data);\r\n      else setMethods([]);\r\n      setLoading(false);\r\n    };\r\n\r\n    fetchMethods();\r\n  }, [transaction]);\r\n\r\n  const handleContinue = async () => {\r\n    if (!selectedMethod) return alert('Selecciona un método de pago');\r\n\r\n    setLoading(true);\r\n\r\n    const { error } = await supabase\r\n      .from('transactions')\r\n      .update({ payment_method_origin_id: selectedMethod.id, status: 'Método seleccionado' })\r\n      .eq('id', transactionId);\r\n\r\n    if (!error) navigate('/send/step3', { state: { transactionId } });\r\n    setLoading(false);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <Layout>\r\n        <div className=\"flex items-center justify-center min-h-screen text-blue-900 font-bold\">\r\n          Cargando...\r\n        </div>\r\n      </Layout>\r\n    );\r\n  }\r\n\r\n  if (!transaction) {\r\n    return (\r\n      <Layout>\r\n        <div className=\"flex items-center justify-center min-h-screen text-red-500 font-bold\">\r\n          No se pudo cargar la transacción.\r\n        </div>\r\n      </Layout>\r\n    );\r\n  }\r\n\r\n  if (methods.length === 0) {\r\n    return (\r\n      <Layout>\r\n        <div className=\"flex flex-col items-center justify-center min-h-screen text-red-500 font-bold\">\r\n          No hay métodos de pago disponibles para tu país de origen.\r\n        </div>\r\n      </Layout>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Layout>\r\n      <div className=\"px-6 py-8 max-w-md mx-auto\">\r\n        <motion.h2\r\n          initial={{ opacity: 0, y: 20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          className=\"text-2xl font-bold text-gray-800 mb-8 text-center\"\r\n        >\r\n          Selecciona un método de pago\r\n        </motion.h2>\r\n\r\n        <div className=\"space-y-4\">\r\n          {methods.map((method) => (\r\n            <motion.div\r\n              key={method.id}\r\n              whileTap={{ scale: 0.98 }}\r\n              onClick={() => setSelectedMethod(method)}\r\n              className={`p-5 rounded-2xl border shadow-md text-center font-semibold text-lg cursor-pointer transition-all duration-200 ${\r\n                selectedMethod?.id === method.id\r\n                  ? 'border-blue-900 bg-blue-50 text-blue-900'\r\n                  : 'border-gray-200 bg-white hover:shadow-lg'\r\n              }`}\r\n            >\r\n              {method.method}\r\n            </motion.div>\r\n          ))}\r\n        </div>\r\n\r\n        <button\r\n          className=\"w-full mt-8 bg-blue-900 text-white py-3 rounded-xl text-lg font-semibold shadow-md hover:bg-blue-800 transition-colors\"\r\n          onClick={handleContinue}\r\n        >\r\n          Continuar\r\n        </button>\r\n      </div>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default PaymentStep;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}