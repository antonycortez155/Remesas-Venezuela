{"ast":null,"code":"import React,{useState}from'react';import{motion}from'framer-motion';import{useNavigate}from'react-router-dom';import{ArrowLeft}from'lucide-react';import{supabase}from'../supabaseClient';import{useApp}from'../context/AppContext';import PhoneInput from'react-phone-input-2';import'react-phone-input-2/lib/style.css';import ReactCountryFlag from'react-country-flag';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const prefixToCountry={\"+57\":{code:\"CO\",name:\"Colombia\"},\"+58\":{code:\"VE\",name:\"Venezuela\"},\"+507\":{code:\"PA\",name:\"Panamá\"},\"+1\":{code:\"US\",name:\"Estados Unidos\"}};const ForgotPassword=()=>{const navigate=useNavigate();const{setResetPhone}=useApp();const[phone,setPhone]=useState('');const[countryCode,setCountryCode]=useState('+57');const[countryName,setCountryName]=useState('Colombia');const[message,setMessage]=useState('');const[loading,setLoading]=useState(false);const handleSendCode=async()=>{if(!phone.trim()){setMessage(\"El número de teléfono es obligatorio.\");return;}setLoading(true);setMessage(\"\");// Verificar si el usuario existe\nconst{data:user}=await supabase.from(\"users\").select(\"*\").eq(\"phone\",phone.trim()).maybeSingle();if(!user){setMessage(\"Este número no está registrado.\");setLoading(false);return;}// Generar código\nconst code=Math.floor(100000+Math.random()*900000).toString();const expiresAt=new Date(Date.now()+5*60*1000).toISOString();// Guardar en pending_codes (sin contraseña porque NO se cambia aquí)\nconst{error:upsertError}=await supabase.from(\"pending_codes\").upsert({phone:phone.trim(),code:code,expires_at:expiresAt,// la contraseña se enviará en la pantalla de confirmación\npassword_hash:\"\",country_code:countryCode,country_name:countryName,sent:false},{onConflict:\"phone\"});if(upsertError){console.error(upsertError);setMessage(\"Hubo un error guardando el código.\");setLoading(false);return;}// Guardamos el teléfono en contexto\nsetResetPhone(phone.trim());console.log(\"Código enviado:\",code);// Marcar como enviado\nawait supabase.from(\"pending_codes\").update({sent:true}).eq(\"phone\",phone.trim());setTimeout(()=>{navigate(\"/verify-reset-code\");},600);setLoading(false);};return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen px-6 py-8\",children:[/*#__PURE__*/_jsxs(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:\"flex items-center mb-8\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/login'),className:\"p-2 rounded-full hover:bg-gray-100\",children:/*#__PURE__*/_jsx(ArrowLeft,{className:\"w-6 h-6 text-gray-700\"})}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold ml-4\",children:\"Recuperar Contrase\\xF1a\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-md mx-auto mt-10\",children:[message&&/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500 mb-3\",children:message}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-6 relative\",children:/*#__PURE__*/_jsx(PhoneInput,{country:\"co\",value:phone,onChange:(value,data)=>{const formatted=value.startsWith('+')?value:\"+\".concat(value);setPhone(formatted);const prefix=\"+\".concat(data.dialCode);const country=prefixToCountry[prefix]||{code:data.countryCode.toUpperCase(),name:data.name};setCountryCode(prefix);setCountryName(country.name);},inputStyle:{width:'100%',borderRadius:'12px',height:'55px',paddingLeft:'60px'},buttonStyle:{borderRadius:'12px'},enableSearch:true,placeholder:\"Selecciona tu pa\\xEDs y escribe tu n\\xFAmero\",disabled:loading,renderButton:country=>/*#__PURE__*/_jsxs(\"div\",{className:\"absolute left-2 top-1/2 transform -translate-y-1/2 flex items-center\",children:[/*#__PURE__*/_jsx(ReactCountryFlag,{countryCode:country.countryCode.toUpperCase(),svg:true,style:{width:'24px',height:'24px'}}),/*#__PURE__*/_jsxs(\"span\",{className:\"ml-2 text-gray-600\",children:[\"+\",country.dialCode]})]})})}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSendCode,disabled:loading,className:\"w-full bg-blue-900 text-white py-4 rounded-2xl\",children:loading?\"Enviando...\":\"Enviar código\"})]})]});};export default ForgotPassword;","map":{"version":3,"names":["React","useState","motion","useNavigate","ArrowLeft","supabase","useApp","PhoneInput","ReactCountryFlag","jsx","_jsx","jsxs","_jsxs","prefixToCountry","code","name","ForgotPassword","navigate","setResetPhone","phone","setPhone","countryCode","setCountryCode","countryName","setCountryName","message","setMessage","loading","setLoading","handleSendCode","trim","data","user","from","select","eq","maybeSingle","Math","floor","random","toString","expiresAt","Date","now","toISOString","error","upsertError","upsert","expires_at","password_hash","country_code","country_name","sent","onConflict","console","log","update","setTimeout","className","children","div","initial","opacity","x","animate","onClick","country","value","onChange","formatted","startsWith","concat","prefix","dialCode","toUpperCase","inputStyle","width","borderRadius","height","paddingLeft","buttonStyle","enableSearch","placeholder","disabled","renderButton","svg","style"],"sources":["C:/Users/Usuario/Desktop/intento de app/src/pages/ForgotPassword.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { ArrowLeft } from 'lucide-react';\r\nimport { supabase } from '../supabaseClient';\r\nimport { useApp } from '../context/AppContext';\r\nimport PhoneInput from 'react-phone-input-2';\r\nimport 'react-phone-input-2/lib/style.css';\r\nimport ReactCountryFlag from 'react-country-flag';\r\n\r\nconst prefixToCountry = {\r\n  \"+57\": { code: \"CO\", name: \"Colombia\" },\r\n  \"+58\": { code: \"VE\", name: \"Venezuela\" },\r\n  \"+507\": { code: \"PA\", name: \"Panamá\" },\r\n  \"+1\": { code: \"US\", name: \"Estados Unidos\" },\r\n};\r\n\r\nconst ForgotPassword = () => {\r\n  const navigate = useNavigate();\r\n  const { setResetPhone } = useApp();\r\n\r\n  const [phone, setPhone] = useState('');\r\n  const [countryCode, setCountryCode] = useState('+57');\r\n  const [countryName, setCountryName] = useState('Colombia');\r\n  const [message, setMessage] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const handleSendCode = async () => {\r\n    if (!phone.trim()) {\r\n      setMessage(\"El número de teléfono es obligatorio.\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setMessage(\"\");\r\n\r\n    // Verificar si el usuario existe\r\n    const { data: user } = await supabase\r\n      .from(\"users\")\r\n      .select(\"*\")\r\n      .eq(\"phone\", phone.trim())\r\n      .maybeSingle();\r\n\r\n    if (!user) {\r\n      setMessage(\"Este número no está registrado.\");\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    // Generar código\r\n    const code = Math.floor(100000 + Math.random() * 900000).toString();\r\n    const expiresAt = new Date(Date.now() + 5 * 60 * 1000).toISOString();\r\n\r\n    // Guardar en pending_codes (sin contraseña porque NO se cambia aquí)\r\n    const { error: upsertError } = await supabase\r\n      .from(\"pending_codes\")\r\n      .upsert(\r\n        {\r\n          phone: phone.trim(),\r\n          code: code,\r\n          expires_at: expiresAt,\r\n          // la contraseña se enviará en la pantalla de confirmación\r\n          password_hash: \"\",\r\n          country_code: countryCode,\r\n          country_name: countryName,\r\n          sent: false\r\n        },\r\n        { onConflict: \"phone\" }\r\n      );\r\n\r\n    if (upsertError) {\r\n      console.error(upsertError);\r\n      setMessage(\"Hubo un error guardando el código.\");\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    // Guardamos el teléfono en contexto\r\n    setResetPhone(phone.trim());\r\n\r\n    console.log(\"Código enviado:\", code);\r\n\r\n    // Marcar como enviado\r\n    await supabase\r\n      .from(\"pending_codes\")\r\n      .update({ sent: true })\r\n      .eq(\"phone\", phone.trim());\r\n\r\n    setTimeout(() => {\r\n      navigate(\"/verify-reset-code\");\r\n    }, 600);\r\n\r\n    setLoading(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen px-6 py-8\">\r\n      <motion.div\r\n        initial={{ opacity: 0, x: -20 }}\r\n        animate={{ opacity: 1, x: 0 }}\r\n        className=\"flex items-center mb-8\"\r\n      >\r\n        <button\r\n          onClick={() => navigate('/login')}\r\n          className=\"p-2 rounded-full hover:bg-gray-100\"\r\n        >\r\n          <ArrowLeft className=\"w-6 h-6 text-gray-700\" />\r\n        </button>\r\n        <h1 className=\"text-2xl font-bold ml-4\">Recuperar Contraseña</h1>\r\n      </motion.div>\r\n\r\n      <div className=\"max-w-md mx-auto mt-10\">\r\n        {message && <p className=\"text-red-500 mb-3\">{message}</p>}\r\n\r\n        {/* TELÉFONO CON SELECTOR DE PAÍS */}\r\n        <div className=\"mb-6 relative\">\r\n          <PhoneInput\r\n            country=\"co\"\r\n            value={phone}\r\n            onChange={(value, data) => {\r\n              const formatted = value.startsWith('+') ? value : `+${value}`;\r\n              setPhone(formatted);\r\n\r\n              const prefix = `+${data.dialCode}`;\r\n              const country = prefixToCountry[prefix] || {\r\n                code: data.countryCode.toUpperCase(),\r\n                name: data.name,\r\n              };\r\n\r\n              setCountryCode(prefix);\r\n              setCountryName(country.name);\r\n            }}\r\n            inputStyle={{\r\n              width: '100%',\r\n              borderRadius: '12px',\r\n              height: '55px',\r\n              paddingLeft: '60px'\r\n            }}\r\n            buttonStyle={{ borderRadius: '12px' }}\r\n            enableSearch\r\n            placeholder=\"Selecciona tu país y escribe tu número\"\r\n            disabled={loading}\r\n            renderButton={(country) => (\r\n              <div className=\"absolute left-2 top-1/2 transform -translate-y-1/2 flex items-center\">\r\n                <ReactCountryFlag\r\n                  countryCode={country.countryCode.toUpperCase()}\r\n                  svg\r\n                  style={{ width: '24px', height: '24px' }}\r\n                />\r\n                <span className=\"ml-2 text-gray-600\">+{country.dialCode}</span>\r\n              </div>\r\n            )}\r\n          />\r\n        </div>\r\n\r\n        <button\r\n          onClick={handleSendCode}\r\n          disabled={loading}\r\n          className=\"w-full bg-blue-900 text-white py-4 rounded-2xl\"\r\n        >\r\n          {loading ? \"Enviando...\" : \"Enviar código\"}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ForgotPassword;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}