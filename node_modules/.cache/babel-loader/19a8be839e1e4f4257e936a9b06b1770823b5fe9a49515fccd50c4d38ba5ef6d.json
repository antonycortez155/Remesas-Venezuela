{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useNavigate,useLocation}from\"react-router-dom\";import{supabase}from\"../../supabaseClient\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const METHOD_NAMES={pagomovil:\"Pago mÃ³vil\",bank_transfer:\"Transferencia bancaria\",western:\"Western\",zelle:\"Zelle\",bancolombia:\"Bancolombia\"// agrega otros mÃ©todos que uses\n};const FIELD_LABELS={holder_name:\"Titular\",document_type:\"Tipo de documento\",document_number:\"NÃºmero de documento\",account_number:\"NÃºmero de cuenta / TelÃ©fono / Identificador\",bank:\"Banco\",account_type:\"Tipo de cuenta\",instructions:\"Instrucciones\"};export default function Step5(){const navigate=useNavigate();const location=useLocation();const{transactionId}=location.state;const[transaction,setTransaction]=useState(null);const[originMethod,setOriginMethod]=useState(null);const[reference,setReference]=useState(\"\");const[loading,setLoading]=useState(true);const[submitting,setSubmitting]=useState(false);const[showBanner,setShowBanner]=useState(false);useEffect(()=>{const fetchTransaction=async()=>{setLoading(true);const{data:trx,error:trxError}=await supabase.from(\"transactions\").select(\"*\").eq(\"id\",transactionId).single();if(trxError){console.error(\"Error cargando transacciÃ³n:\",trxError);setLoading(false);return;}setTransaction(trx);if(trx.payment_method_origin_id){const{data:origin,error:originError}=await supabase.from(\"payment_methods_origin\").select(\"*\").eq(\"id\",trx.payment_method_origin_id).single();if(!originError)setOriginMethod(origin);}setLoading(false);};fetchTransaction();},[transactionId]);const handlePaymentDone=async()=>{if(!transaction)return;if(!reference.trim()){alert(\"Debes ingresar la referencia de pago\");return;}setSubmitting(true);const{error}=await supabase.from(\"transactions\").update({status:\"Procesando\",payment_reference:reference}).eq(\"id\",transaction.id);setSubmitting(false);if(error){console.error(\"Error actualizando transacciÃ³n:\",error);alert(\"Error al registrar la referencia de pago\");return;}setShowBanner(true);setTimeout(()=>{navigate(\"/history\");},1500);};const handleBack=()=>{navigate(-1);};if(loading)return/*#__PURE__*/_jsx(\"p\",{children:\"Cargando...\"});const renderField=(label,value)=>{if(!value)return null;return/*#__PURE__*/_jsxs(\"p\",{className:\"mb-2\",children:[/*#__PURE__*/_jsxs(\"strong\",{children:[label,\":\"]}),\" \",value]});};const renderOriginFields=data=>{if(!data)return null;const methodName=METHOD_NAMES[data.method]||data.method;return/*#__PURE__*/_jsxs(_Fragment,{children:[renderField(\"MÃ©todo de Pago\",methodName),renderField(\"Instrucciones\",data.instructions),Object.entries(data.data||{}).map(_ref=>{let[key,value]=_ref;if(!value)return null;// No mostrar banco si es igual a mÃ©todo de pago\nif(key===\"bank\"&&value===methodName)return null;const label=FIELD_LABELS[key]||key.replace(\"_\",\" \").toUpperCase();return renderField(label,value);})]});};return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen p-5 bg-gradient-to-b from-blue-50 to-blue-100\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-blue-800 mb-6 text-center\",children:\"Realiza la transacci\\xF3n \\uD83D\\uDCB3\"}),showBanner&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-6 p-4 bg-green-200 border-l-4 border-green-500 text-green-800 rounded-xl shadow-md\",children:\"\\xA1Pago registrado correctamente! \\u2705\"}),originMethod&&/*#__PURE__*/_jsxs(\"div\",{className:\"p-6 bg-white shadow-lg rounded-2xl border border-blue-200 mb-6\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold text-blue-700 mb-2\",children:\"M\\xE9todo de Pago Origen\"}),renderOriginFields(originMethod)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block font-semibold text-blue-700 mb-2\",children:\"Referencia de pago\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:reference,onChange:e=>setReference(e.target.value),className:\"w-full p-3 rounded-2xl border border-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-500\",placeholder:\"Ingresa la referencia de pago\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"bg-gray-300 text-black py-2 px-5 rounded-2xl hover:bg-gray-400\",onClick:handleBack,children:\"Atr\\xE1s\"}),/*#__PURE__*/_jsx(\"button\",{className:\"bg-blue-700 text-white py-2 px-5 rounded-2xl hover:bg-blue-800 \".concat(submitting?\"opacity-70 cursor-not-allowed\":\"\"),onClick:handlePaymentDone,disabled:submitting,children:submitting?\"Registrando...\":\"Pago realizado\"})]})]});}","map":{"version":3,"names":["React","useEffect","useState","useNavigate","useLocation","supabase","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","METHOD_NAMES","pagomovil","bank_transfer","western","zelle","bancolombia","FIELD_LABELS","holder_name","document_type","document_number","account_number","bank","account_type","instructions","Step5","navigate","location","transactionId","state","transaction","setTransaction","originMethod","setOriginMethod","reference","setReference","loading","setLoading","submitting","setSubmitting","showBanner","setShowBanner","fetchTransaction","data","trx","error","trxError","from","select","eq","single","console","payment_method_origin_id","origin","originError","handlePaymentDone","trim","alert","update","status","payment_reference","id","setTimeout","handleBack","children","renderField","label","value","className","renderOriginFields","methodName","method","Object","entries","map","_ref","key","replace","toUpperCase","type","onChange","e","target","placeholder","onClick","concat","disabled"],"sources":["C:/Users/Usuario/Desktop/intento de app/src/pages/flows/PantallaMetodoPago.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useNavigate, useLocation } from \"react-router-dom\";\r\nimport { supabase } from \"../../supabaseClient\";\r\n\r\nconst METHOD_NAMES = {\r\n  pagomovil: \"Pago mÃ³vil\",\r\n  bank_transfer: \"Transferencia bancaria\",\r\n  western: \"Western\",\r\n  zelle: \"Zelle\",\r\n  bancolombia: \"Bancolombia\",\r\n  // agrega otros mÃ©todos que uses\r\n};\r\n\r\nconst FIELD_LABELS = {\r\n  holder_name: \"Titular\",\r\n  document_type: \"Tipo de documento\",\r\n  document_number: \"NÃºmero de documento\",\r\n  account_number: \"NÃºmero de cuenta / TelÃ©fono / Identificador\",\r\n  bank: \"Banco\",\r\n  account_type: \"Tipo de cuenta\",\r\n  instructions: \"Instrucciones\",\r\n};\r\n\r\nexport default function Step5() {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { transactionId } = location.state;\r\n\r\n  const [transaction, setTransaction] = useState(null);\r\n  const [originMethod, setOriginMethod] = useState(null);\r\n  const [reference, setReference] = useState(\"\");\r\n  const [loading, setLoading] = useState(true);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [showBanner, setShowBanner] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const fetchTransaction = async () => {\r\n      setLoading(true);\r\n\r\n      const { data: trx, error: trxError } = await supabase\r\n        .from(\"transactions\")\r\n        .select(\"*\")\r\n        .eq(\"id\", transactionId)\r\n        .single();\r\n\r\n      if (trxError) {\r\n        console.error(\"Error cargando transacciÃ³n:\", trxError);\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      setTransaction(trx);\r\n\r\n      if (trx.payment_method_origin_id) {\r\n        const { data: origin, error: originError } = await supabase\r\n          .from(\"payment_methods_origin\")\r\n          .select(\"*\")\r\n          .eq(\"id\", trx.payment_method_origin_id)\r\n          .single();\r\n\r\n        if (!originError) setOriginMethod(origin);\r\n      }\r\n\r\n      setLoading(false);\r\n    };\r\n\r\n    fetchTransaction();\r\n  }, [transactionId]);\r\n\r\n  const handlePaymentDone = async () => {\r\n    if (!transaction) return;\r\n    if (!reference.trim()) {\r\n      alert(\"Debes ingresar la referencia de pago\");\r\n      return;\r\n    }\r\n\r\n    setSubmitting(true);\r\n\r\n    const { error } = await supabase\r\n      .from(\"transactions\")\r\n      .update({\r\n        status: \"Procesando\",\r\n        payment_reference: reference\r\n      })\r\n      .eq(\"id\", transaction.id);\r\n\r\n    setSubmitting(false);\r\n\r\n    if (error) {\r\n      console.error(\"Error actualizando transacciÃ³n:\", error);\r\n      alert(\"Error al registrar la referencia de pago\");\r\n      return;\r\n    }\r\n\r\n    setShowBanner(true);\r\n\r\n    setTimeout(() => {\r\n      navigate(\"/history\");\r\n    }, 1500);\r\n  };\r\n\r\n  const handleBack = () => {\r\n    navigate(-1);\r\n  };\r\n\r\n  if (loading) return <p>Cargando...</p>;\r\n\r\n  const renderField = (label, value) => {\r\n    if (!value) return null;\r\n    return (\r\n      <p className=\"mb-2\">\r\n        <strong>{label}:</strong> {value}\r\n      </p>\r\n    );\r\n  };\r\n\r\n  const renderOriginFields = (data) => {\r\n    if (!data) return null;\r\n\r\n    const methodName = METHOD_NAMES[data.method] || data.method;\r\n\r\n    return (\r\n      <>\r\n        {renderField(\"MÃ©todo de Pago\", methodName)}\r\n        {renderField(\"Instrucciones\", data.instructions)}\r\n        {Object.entries(data.data || {}).map(([key, value]) => {\r\n          if (!value) return null;\r\n\r\n          // No mostrar banco si es igual a mÃ©todo de pago\r\n          if (key === \"bank\" && value === methodName) return null;\r\n\r\n          const label = FIELD_LABELS[key] || key.replace(\"_\", \" \").toUpperCase();\r\n          return renderField(label, value);\r\n        })}\r\n      </>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen p-5 bg-gradient-to-b from-blue-50 to-blue-100\">\r\n      <h1 className=\"text-2xl font-bold text-blue-800 mb-6 text-center\">\r\n        Realiza la transacciÃ³n ðŸ’³\r\n      </h1>\r\n\r\n      {showBanner && (\r\n        <div className=\"mb-6 p-4 bg-green-200 border-l-4 border-green-500 text-green-800 rounded-xl shadow-md\">\r\n          Â¡Pago registrado correctamente! âœ…\r\n        </div>\r\n      )}\r\n\r\n      {originMethod && (\r\n        <div className=\"p-6 bg-white shadow-lg rounded-2xl border border-blue-200 mb-6\">\r\n          <p className=\"font-semibold text-blue-700 mb-2\">MÃ©todo de Pago Origen</p>\r\n          {renderOriginFields(originMethod)}\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"mb-6\">\r\n        <label className=\"block font-semibold text-blue-700 mb-2\">Referencia de pago</label>\r\n        <input\r\n          type=\"text\"\r\n          value={reference}\r\n          onChange={(e) => setReference(e.target.value)}\r\n          className=\"w-full p-3 rounded-2xl border border-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n          placeholder=\"Ingresa la referencia de pago\"\r\n        />\r\n      </div>\r\n\r\n      <div className=\"flex justify-between\">\r\n        <button\r\n          className=\"bg-gray-300 text-black py-2 px-5 rounded-2xl hover:bg-gray-400\"\r\n          onClick={handleBack}\r\n        >\r\n          AtrÃ¡s\r\n        </button>\r\n        <button\r\n          className={`bg-blue-700 text-white py-2 px-5 rounded-2xl hover:bg-blue-800 ${submitting ? \"opacity-70 cursor-not-allowed\" : \"\"}`}\r\n          onClick={handlePaymentDone}\r\n          disabled={submitting}\r\n        >\r\n          {submitting ? \"Registrando...\" : \"Pago realizado\"}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}